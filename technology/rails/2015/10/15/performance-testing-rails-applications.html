<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Performance Testing Rails Applications</title>
  <meta name="description" content="Measuring the performance of a rails application is very important before it is deployed to production. Rails framework provides various tools to measure the...">

  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800|Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/blog/css/bootstrap.min.css">
  <link rel="stylesheet" href="/blog/css/main.css">
  <link rel="canonical" href="https://weavelabs.com/blog/technology/rails/2015/10/15/performance-testing-rails-applications.html">
  <link rel="alternate" type="application/rss+xml" title="WeaveLabs Blog" href="https://weavelabs.com/blog/feed.xml">
  <link rel="shortcut icon" href="/favicon.png">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>


  <body>

    <header class="site-header">

  <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/blog/">WeaveLabs Blog</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/blog/">View All Posts</a>
                    </li>
                    <li>
                        <a href="https://weavelabs.com">Visit WeaveLabs.com</a>
                    </li>
                </ul>
            </div>
            <!-- <div class="trigger">
              
                
              
                
              
                
              
            </div> -->

        </div>
        <!-- /.container -->
    </nav>

</header>


    <!-- Navigation -->



    <div class="page-content">
      <div class="wrapper">
        <header class="intro-header" style="background-image: url('/blog/images/perfrails.jpg')">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Performance Testing Rails Applications</h1>
          <h2 class="subheading">Tools to measure the performance of a rails application</h2>
          <span class="meta">Posted by  • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Awin Abi</span></span> on
          <time datetime="2015-10-15T18:32:00+05:30" itemprop="datePublished">Oct 15, 2015</time>
          </span>
        </div>
      </div>
    </div>
  </div>
</header>
<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1">
        <p>Measuring the performance of a rails application is very important before it is deployed to production. Rails framework provides various tools to measure the performance of the application.</p>

<p>Performance tests are typically integration tests that helps identify the application’s memory and speed issues.</p>

<!--more-->
<h2>Setting Up</h2>

<p>You can use the rails-perftest gem to benchmark and profile rails code.
Include the following gems in your project’s Gemfile</p>

<div class="highlighter-rouge"><pre class="highlight"><code>gem 'rails-perftest'
gem 'ruby-prof' # for MRI profiling

</code></pre>
</div>

<h2>Writing performance test cases</h2>

<p>As mentioned before performance tests are special integration tests in the rails application.
Assume that you would want to test the dashboard of your application which has the following code:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code>
<span class="c1"># app/controllers/dashboard_controller.rb</span>
<span class="c1"># accessible via route /dashboard</span>
<span class="k">class</span> <span class="nc">DashboardController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@comment_list</span> <span class="o">=</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"commentable_id IN (?) AND commentable_type = ?  AND commented_by != ? AND description != ? and visible = true"</span><span class="p">,</span> <span class="n">completed_evaluations_id</span> <span class="p">,</span><span class="s1">'EvaluationInstance'</span><span class="p">,</span><span class="n">current_employee</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span><span class="s2">""</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="s1">'created_at desc'</span><span class="p">).</span><span class="nf">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre>
</div>
<p>This dashboard action gets the latest feedback of given to the user in the form of comments. The performance test for this action can be something like the following:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code>
<span class="nb">require</span> <span class="s1">'test_helper'</span>
<span class="nb">require</span> <span class="s1">'rails/performance_test_help'</span>

<span class="k">class</span> <span class="nc">PostPerformanceTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">PerformanceTest</span>
  <span class="k">def</span> <span class="nf">setup</span>
    <span class="n">login_as</span><span class="p">(</span><span class="ss">:employee</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"Access Dashboard"</span> <span class="k">do</span>
    <span class="n">gte</span> <span class="s1">'/dashboard'</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre>
</div>
<p>The performance test will provide details like the time take for the action, the number of objects created and total memory used for this.</p>

<p>Similary a model performance test can be used to give an idea on the time required for a function. This can come in handy while running complex queries against the database.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code>
  <span class="nb">test</span> <span class="s2">"slow method"</span> <span class="k">do</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:comment</span><span class="p">)</span>
    <span class="n">comment</span><span class="p">.</span><span class="nf">slow_method</span>
  <span class="k">end</span>

</code></pre>
</div>

<h2>Running performance tests</h2>

<p>Performance tests can be run in two modes - benchmarking and profiling modes.</p>

<p>Benchmarking makes it easy to quickly gather a few metrics about each test run. Each test case is run multiple times( by default 4 times) in benchmarking mode.</p>

<p>Performance test can be run in benchmarking mode using</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>rake <span class="nb">test</span>:benchmark
</code></pre>
</div>

<p>Profiling does an in-depth analysis using an external profiler. For MRI this is done using RubyProf. Here each test case is run only once.</p>

<p>Profiling can be done using:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>
<span class="gp">$ </span>rake <span class="nb">test</span>:profile

</code></pre>
</div>

<p>Benchmarking and profiling gives multiple metrics as results including various time, memory and garbage collection metrics. More details can be found <a href="https://github.com/rails/rails-perftest#metrics">in this readme page</a></p>

<h2>Command line tools</h2>

<p>For quick and dirty performance testing(without writing performance test files), this also provides command line tools <code class="highlighter-rouge">benchmarker</code> and <code class="highlighter-rouge">profiler</code>. Each of this command can be run by passing a snippet of code to it.</p>

<p>An example run could be as follows:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>perftest benchmarker <span class="s1">'Comment.all'</span> --runs 3 --metrics wall_time,memory
</code></pre>
</div>

<p>Performance tests are a useful tools to measure, benchmark and profile blocks of code in your rails applicaton. A well written performance test can help a developer to analyse the most time taking parts of the key execution paths in the application.</p>


      </div>
    </div>
  </div>
</article>

      </div>
    </div>

    <!-- <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">WeaveLabs Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>WeaveLabs Blog</li>
          <li><a href="mailto:hello@weavelabs.com">hello@weavelabs.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/weavelabs"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">weavelabs</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/weavelabs"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">weavelabs</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Weave Labs is a technology consulting firm and development house located in the beautiful environs of Kerala, India. We have expertise in building solutions for the web and mobile devises, designing scalable architectures, building Android and iOS applications, and creating fast MVPs using Ruby on Rails, CodeIgnitor, Play, Spring and other modern web frameworks.
</p>
      </div>
    </div>

  </div>

</footer> -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8  col-lg-offset-1 col-md-10 col-md-offset-1">
        <ul class="list-inline">
          <li>
            <a href="https://twitter.com/weavelabs">
              <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://www.facebook.com/weavelabs">
              <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
        </ul>
        <p class="copyright text-muted">Copyright &copy; WeaveLabs 2013 - 2017</p>
      </div>
    </div>
  </div>
</footer>
<script src="/blog/js/jquery.js"></script>
<script src="/blog/js/bootstrap.min.js"></script>
<script src="/blog/js/clean-blog.min.js"></script>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5704d4a136a85b2f"></script>

<script>
  (function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

  ga('create', 'UA-77527928-1', 'auto');
  ga('send', 'pageview');
</script>


  </body>
</html>
